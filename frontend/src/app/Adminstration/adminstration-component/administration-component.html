<!-- Loading / Error States -->
<div *ngIf="loading" class="loading">
  <i class="fas fa-spinner fa-spin"></i> Loading administrator data...
</div>
<div *ngIf="error" class="error">
  <i class="fas fa-exclamation-triangle"></i> {{ error }}
</div>

<!-- Admin Container -->
<div *ngIf="!loading && !error" class="admin-container">

  <!-- Profile Completion Banner -->
  <div *ngIf="profileCompletion < 100" class="completion-banner">
    <div class="completion-info">
      <strong><i class="fas fa-tasks"></i> Profile Completion:</strong>
      <span class="progress-number">{{ profileCompletion }}%</span>
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="profileCompletion"></div>
      </div>
    </div>
    <button class="completion-btn" (click)="openEditModal()">
      <i class="fas fa-user-edit"></i> Complete Profile
    </button>
  </div>

  <!-- Admin Header -->
  <div class="admin-header">
    <div class="admin-image-wrapper">
      <img *ngIf="admin.profilePicture; else noImage" [src]="'data:image/png;base64,' + admin.profilePicture" alt="Profile Picture" class="admin-image" />
      <ng-template #noImage>
        <div class="no-image">
          <i class="fas fa-user-tie"></i>
        </div>
      </ng-template>
    </div>

    <div class="admin-info">
      <div class="admin-name-status">
        <h2><i class="fas fa-user"></i> {{ admin.firstName || 'First Name' }} {{ admin.lastName || 'Last Name' }}</h2>
        <span class="status-badge" [ngClass]="admin.validated">
          <i class="fas"
             [class.fa-check-circle]="admin.validated === 'validated'"
             [class.fa-times-circle]="admin.validated === 'rejected'"
             [class.fa-clock]="admin.validated === 'pending'"
             [class.fa-question-circle]="!admin.validated || admin.validated === 'nonValidated'"></i>
          {{ admin.validated || 'Not Validated' | titlecase }}
        </span>
      </div>
      <p><i class="fas fa-briefcase"></i> Role: {{ admin.role || 'N/A' }}</p>
      <div class="action-buttons">
        <button class="edit-btn" (click)="openEditModal()"><i class="fas fa-edit"></i> Edit</button>
        <button class="delete-btn" (click)="deleteAdmin()"><i class="fas fa-trash-alt"></i> Delete</button>
      </div>
    </div>
  </div>

  <!-- Section Buttons -->
  <div class="button-group">
    <button (click)="showSection('basic')" [class.active]="activeSection==='basic'"><i class="fas fa-info-circle"></i> Basic Info</button>
    <button (click)="showSection('credentials')" [class.active]="activeSection==='credentials'"><i class="fas fa-file-alt"></i> Credentials</button>
    <button (click)="showSection('details')" [class.active]="activeSection==='details'"><i class="fas fa-history"></i> Audit Details</button>
  </div>

  <!-- Sections -->
  <div class="section" *ngIf="activeSection==='basic'">
    <p><strong><i class="fas fa-birthday-cake"></i> Date of Birth:</strong> {{ admin.dateOfBirth ? (admin.dateOfBirth | date:'longDate') : 'N/A' }}</p>
    <p><strong><i class="fas fa-flag"></i> Nationality:</strong> {{ admin.nationality || 'N/A' }}</p>
    <p><strong><i class="fas fa-venus-mars"></i> Gender:</strong> {{ admin.gender || 'N/A' }}</p>
    <p><strong><i class="fas fa-phone"></i> Phone:</strong> {{ admin.phoneNumber || 'N/A' }}</p>
    <p><strong><i class="fas fa-envelope"></i> Email:</strong> {{ admin.email || 'N/A' }}</p>
    <p><strong><i class="fas fa-map-marker-alt"></i> Address:</strong> {{ admin.address || 'N/A' }}</p>
  </div>

  <div class="section" *ngIf="activeSection==='credentials'">
    <app-user-files-component [UserId]="admin.id!"></app-user-files-component>
  </div>

  <div class="section" *ngIf="activeSection==='details'">
    <p><strong><i class="fas fa-user-plus"></i> Created By:</strong> {{ admin.createdBy || 'N/A' }}</p>
    <p><strong><i class="fas fa-calendar-plus"></i> Created At:</strong> {{ admin.createdAt ? (admin.createdAt | date:'medium') : 'N/A' }}</p>
    <p><strong><i class="fas fa-user-edit"></i> Updated By:</strong> {{ admin.updatedBy || 'N/A' }}</p>
    <p><strong><i class="fas fa-calendar-alt"></i> Updated At:</strong> {{ admin.updatedAt ? (admin.updatedAt | date:'medium') : 'N/A' }}</p>
    <p><strong><i class="fas fa-user-check"></i> Validated By:</strong> {{ admin.validatedBy || 'N/A' }}</p>
    <p><strong><i class="fas fa-clipboard-check"></i> Validation Status:</strong> {{ admin.validated || 'Not Validated' }}</p>
  </div>
</div>

<!-- Edit / Complete Profile Modal -->
<div *ngIf="isEditModalOpen" class="modal-backdrop">
  <div class="modal">
    <div class="modal-header">
      <h3><i class="fas fa-user-edit"></i> Edit / Complete Administrator Profile</h3>
      <button class="close-btn" (click)="closeEditModal()"><i class="fas fa-times"></i></button>
    </div>
    <form #editForm="ngForm" (ngSubmit)="saveEditedAdmin(editForm)">
      <div class="form-grid">
        <label><i class="fas fa-user"></i> First Name</label>
        <input name="firstName" [(ngModel)]="editedAdmin.firstName" required />

        <label><i class="fas fa-user"></i> Last Name</label>
        <input name="lastName" [(ngModel)]="editedAdmin.lastName" required />

        <label><i class="fas fa-venus-mars"></i> Gender</label>
        <select name="gender" [(ngModel)]="editedAdmin.gender">
          <option value="">Select</option>
          <option value="MALE">Male</option>
          <option value="FEMALE">Female</option>
        </select>

        <label><i class="fas fa-phone"></i> Phone</label>
        <input name="phoneNumber" [(ngModel)]="editedAdmin.phoneNumber" />

        <label><i class="fas fa-envelope"></i> Email</label>
        <input type="email" name="email" [(ngModel)]="editedAdmin.email" />

        <label><i class="fas fa-map-marker-alt"></i> Address</label>
        <input name="address" [(ngModel)]="editedAdmin.address" />

        <label><i class="fas fa-briefcase"></i> Role</label>
        <input name="role" [(ngModel)]="editedAdmin.role" />
      </div>

      <div class="modal-actions">
        <button type="submit"><i class="fas fa-save"></i> Save</button>
        <button type="button" (click)="closeEditModal()"><i class="fas fa-times"></i> Cancel</button>
      </div>
    </form>
  </div>
</div>
