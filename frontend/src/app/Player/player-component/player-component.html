<!-- Player Component -->
<div *ngIf="loading" class="loading">
  <i class="fas fa-spinner fa-spin"></i> Loading player data...
</div>
<div *ngIf="error" class="error">
  <i class="fas fa-exclamation-triangle"></i> {{ error }}
</div>

<div *ngIf="!loading && !error" class="player-container">

  <!-- Profile Completion Banner -->
  <div *ngIf="profileCompletion < 100" class="completion-banner">
    <div class="completion-info">
      <strong><i class="fas fa-tasks"></i> Profile Completion:</strong>
      <span class="progress-number">{{ profileCompletion }}%</span>
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="profileCompletion"></div>
      </div>
    </div>
    <button class="completion-btn" (click)="openEditModal()">
      <i class="fas fa-user-edit"></i> Complete Profile
    </button>
  </div>

  <!-- Player Header -->
  <div class="player-header">
    <div class="player-image-wrapper">
      <img *ngIf="player.profilePicture; else noImage"
           [src]="'data:image/png;base64,' + player.profilePicture"
           alt="Profile Picture" class="player-image"/>
      <ng-template #noImage>
        <div class="no-image">
          <i class="fas fa-user-circle"></i>
        </div>
      </ng-template>
    </div>

    <div class="player-info">
      <div class="player-name-status">
        <h2>
          <i class="fas fa-user"></i> {{ player.firstName || 'First Name' }} {{ player.lastName || 'Last Name' }}
        </h2>
        <span class="status-badge" [ngClass]="player.validated">
          <i class="fas" [class.fa-check-circle]="player.validated === 'validated'"
             [class.fa-times-circle]="player.validated === 'rejected'"
             [class.fa-clock]="player.validated === 'pending'"
             [class.fa-question-circle]="!player.validated || player.validated === 'nonValidated'"></i>
          {{ player.validated || 'Not Validated' | titlecase }}
        </span>
      </div>

      <div class="action-buttons">
        <button class="edit-btn" (click)="openEditModal()">
          <i class="fas fa-edit"></i> Edit
        </button>
        <button class="delete-btn" (click)="delete()">
          <i class="fas fa-trash-alt"></i> Delete
        </button>
      </div>
    </div>
  </div>

  <!-- Section Buttons -->
  <div class="section-buttons">
    <button *ngFor="let sec of ['basic','profile','stats','medical','credentials','details']"
            (click)="showSection(sec)"
            [class.active]="activeSection===sec">
      <i class="fas" [class.fa-info-circle]="sec === 'basic'"
         [class.fa-user-tag]="sec === 'profile'"
         [class.fa-chart-line]="sec === 'stats'"
         [class.fa-heartbeat]="sec === 'medical'"
         [class.fa-file-alt]="sec === 'credentials'"
         [class.fa-history]="sec === 'details'"></i>
      {{ sec | titlecase }}
    </button>
  </div>

  <!-- Sections -->
  <div class="sections">
    <div *ngIf="activeSection==='basic'" class="section">
      <h3><i class="fas fa-info-circle"></i> Basic Information</h3>
      <p><i class="fas fa-birthday-cake"></i> <strong>Date of Birth:</strong> {{ player.dateOfBirth ? (player.dateOfBirth | date:'longDate') : 'N/A' }}</p>
      <p><i class="fas fa-flag"></i> <strong>Nationality:</strong> {{ player.nationality || 'N/A' }}</p>
      <p><i class="fas fa-venus-mars"></i> <strong>Gender:</strong> {{ player.gender || 'N/A' }}</p>
      <p><i class="fas fa-phone"></i> <strong>Phone:</strong> {{ player.phoneNumber || 'N/A' }}</p>
      <p><i class="fas fa-envelope"></i> <strong>Email:</strong> {{ player.email || 'N/A' }}</p>
      <p><i class="fas fa-map-marker-alt"></i> <strong>Address:</strong> {{ player.address || 'N/A' }}</p>
    </div>

    <div *ngIf="activeSection==='profile'" class="section">
      <h3><i class="fas fa-user-tag"></i> Player Profile</h3>
      <p><i class="fas fa-ruler-vertical"></i> <strong>Height:</strong> {{ player.height ? player.height + ' cm' : 'N/A' }}</p>
      <p><i class="fas fa-weight"></i> <strong>Weight:</strong> {{ player.weight ? player.weight + ' kg' : 'N/A' }}</p>
      <p><i class="fas fa-tshirt"></i> <strong>Jersey Number:</strong> {{ player.jerseyNumber || 'N/A' }}</p>
      <p><i class="fas fa-map-pin"></i> <strong>Position:</strong> {{ player.position || 'N/A' }}</p>
      <p><i class="fas fa-tags"></i> <strong>Categories:</strong>
        <span *ngIf="player.categories?.length; else noCategories">{{ player.categories}}</span>
        <ng-template #noCategories>N/A</ng-template>
      </p>
    </div>

    <div *ngIf="activeSection==='stats'" class="section">
      <h3><i class="fas fa-chart-line"></i> Stats</h3>
      <p><i class="fas fa-running"></i> <strong>Matches:</strong>  {{ player.stats?.matches || 0  </p>
      <p><i class="fas fa-futbol"></i> <strong>Goals:</strong>  {{ player.stats?.goals || 0  </p>
      <p><i class="fas fa-assistive-listening-systems"></i> <strong>Assists:</strong>  {{ player.stats?.assists || 0  </p>
    </div>

    <div *ngIf="activeSection==='medical'" class="section">
      <h3><i class="fas fa-heartbeat"></i> Medical Record</h3>
      <p><i class="fas fa-calendar-check"></i> <strong>Last Checkup:</strong>  player.medicalRecord?.lastCheckup ? (player.medicalRecord.lastCheckup | date:'mediumDate') : 'N/A'  </p>
      <p><i class="fas fa-band-aid"></i> <strong>Injuries:</strong>   player.medicalRecord?.injuries || 'None'  </p>
      <p><i class="fas fa-sticky-note"></i> <strong>Notes:</strong>   player.medicalRecord?.notes || 'No notes'  </p>
    </div>

    <div *ngIf="activeSection==='credentials'" class="section">
      <h3><i class="fas fa-file-alt"></i> Credentials</h3>
      <app-user-files-component [UserId]="player.id!"></app-user-files-component>
    </div>

    <div *ngIf="activeSection==='details'" class="section">
      <h3><i class="fas fa-history"></i> Audit & Validation Details</h3>
      <p><i class="fas fa-user-plus"></i> <strong>Created By:</strong> {{ player.createdBy || 'N/A' }}</p>
      <p><i class="fas fa-calendar-plus"></i> <strong>Created At:</strong> {{ player.createdAt ? (player.createdAt | date:'medium') : 'N/A' }}</p>
      <p><i class="fas fa-user-edit"></i> <strong>Updated By:</strong> {{ player.updatedBy || 'N/A' }}</p>
      <p><i class="fas fa-calendar-alt"></i> <strong>Updated At:</strong> {{ player.updatedAt ? (player.updatedAt | date:'medium') : 'N/A' }}</p>
      <p><i class="fas fa-user-check"></i> <strong>Validated By:</strong> {{ player.validatedBy || 'N/A' }}</p>
      <p><i class="fas fa-calendar-check"></i> <strong>Validation Date:</strong> {{ player.validationDate ? (player.validationDate | date:'medium') : 'N/A' }}</p>
    </div>
  </div>
</div>

<!-- Edit Modal -->
<div *ngIf="isEditModalOpen" class="modal-backdrop">
  <div class="modal">
    <div class="modal-header">
      <h3><i class="fas fa-user-edit"></i> Edit / Complete Profile</h3>
      <button class="close-btn" (click)="closeEditModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <form #editForm="ngForm" (ngSubmit)="saveEditedPlayer(editForm)">
      <div class="form-grid">
        <label><i class="fas fa-user"></i> First Name *</label>
        <input name="firstName" [(ngModel)]="editedPlayer.firstName" required />

        <label><i class="fas fa-user"></i> Last Name *</label>
        <input name="lastName" [(ngModel)]="editedPlayer.lastName" required />

        <label><i class="fas fa-venus-mars"></i> Gender</label>
        <select name="gender" [(ngModel)]="editedPlayer.gender">
          <option value="">Select</option>
          <option value="MALE">Male</option>
          <option value="FEMALE">Female</option>
        </select>

        <label><i class="fas fa-phone"></i> Phone</label>
        <input name="phoneNumber" [(ngModel)]="editedPlayer.phoneNumber" />

        <label><i class="fas fa-envelope"></i> Email</label>
        <input type="email" name="email" [(ngModel)]="editedPlayer.email" />

        <label><i class="fas fa-map-marker-alt"></i> Address</label>
        <input name="address" [(ngModel)]="editedPlayer.address" />

        <label><i class="fas fa-ruler-vertical"></i> Height (cm)</label>
        <input type="number" name="height" [(ngModel)]="editedPlayer.height" />

        <label><i class="fas fa-weight"></i> Weight (kg)</label>
        <input type="number" name="weight" [(ngModel)]="editedPlayer.weight" />

        <label><i class="fas fa-tshirt"></i> Jersey Number</label>
        <input name="jerseyNumber" [(ngModel)]="editedPlayer.jerseyNumber" />

        <label><i class="fas fa-map-pin"></i> Position</label>
        <select name="position" [(ngModel)]="editedPlayer.position" required>
          <option value="">Select Position</option>
          <option *ngFor="let pos of positions" [value]="pos">{{ pos | titlecase }}</option>
        </select>
      </div>
      <div class="modal-actions">
        <button type="submit" class="save-btn">
          <i class="fas fa-save"></i> Save
        </button>
        <button type="button" class="cancel-btn" (click)="closeEditModal()">
          <i class="fas fa-times"></i> Cancel
        </button>
      </div>
    </form>
  </div>
</div>
