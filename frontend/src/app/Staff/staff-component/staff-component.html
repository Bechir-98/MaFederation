<div *ngIf="loading" class="loading">Loading staff data...</div>
<div *ngIf="error" class="error">{{ error }}</div>

<div *ngIf="!loading && !error" class="staff-container">
  <div class="staff-header">
    <img
      *ngIf="staff.profilePicture; else noImage"
      [src]="'data:image/png;base64,' + staff.profilePicture"
      alt="Profile Picture"
      class="staff-image"
    />
    <ng-template #noImage>
      <div class="no-image">No Image Available</div>
    </ng-template>

    <div class="staff-info">
      <div class="staff-name">
        <h2>{{ staff.firstName || 'First Name' }} {{ staff.lastName || 'Last Name' }}</h2>
        <p>{{ staff.specialty || 'Speciality not set' }}</p>
      </div>

      <div class="action-buttons">
        <button class="edit-btn" title="Edit Staff">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
            <path d="m18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
          </svg>
          Edit
        </button>
        <button class="delete-btn" title="Delete Staff">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="3,6 5,6 21,6"/>
            <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"/>
            <line x1="10" y1="11" x2="10" y2="17"/>
            <line x1="14" y1="11" x2="14" y2="17"/>
          </svg>
          Delete
        </button>
      </div>
    </div>
  </div>

  <div class="button-group">
    <button (click)="showSection('basic')" [class.active]="activeSection === 'basic'">Basic Info</button>
    <button (click)="showSection('profile')" [class.active]="activeSection === 'profile'">Staff Profile</button>
    <button (click)="showSection('assignments')" [class.active]="activeSection === 'assignments'">Assignments</button>
    <button (click)="showSection('credentials')" [class.active]="activeSection === 'credentials'">View Credentials</button>
    <button (click)="showSection('details')" [class.active]="activeSection === 'details'">More Details</button>
  </div>

  <div class="section" *ngIf="activeSection === 'basic'">
    <h3>Basic Information</h3>
    <p><strong>Date of Birth:</strong> {{ staff.dateOfBirth ? (staff.dateOfBirth | date:'longDate') : 'N/A' }}</p>
    <p><strong>Nationality:</strong> {{ staff.nationality || 'N/A' }}</p>
    <p><strong>Gender:</strong> {{ staff.gender || 'N/A' }}</p>
    <p><strong>Phone:</strong> {{ staff.phoneNumber || 'N/A' }}</p>
    <p><strong>Email:</strong> {{ staff.email || 'N/A' }}</p>
    <p><strong>Address:</strong> {{ staff.address || 'N/A' }}</p>
  </div>

  <div class="section" *ngIf="activeSection === 'profile'">
    <h3>Staff Profile</h3>
    <p><strong>Specialty:</strong> {{ staff.specialty || 'N/A' }}</p>
    <p><strong>Categories:</strong>
      <span *ngIf="staff.categories && staff.categories.length; else noCategories">
        {{ staff.categories.join(', ') }}
      </span>
      <ng-template #noCategories>N/A</ng-template>
    </p>
    <p><strong>Notes:</strong> {{ staff.lastName || 'N/A' }}</p>
  </div>

  <div class="section" *ngIf="activeSection === 'assignments'">
    <h3>Assignments</h3>
    <p *ngIf="staff.lastName && staff.lastName.length; else noAssignments">
      <ul>
        <li *ngFor="let a of staff.lastName">{{ a }}</li>
      </ul>
    <ng-template #noAssignments>
      <p>No assignments found.</p>
    </ng-template>
  </div>

  <div class="section" *ngIf="activeSection === 'credentials'">
    <h3>Credentials</h3>
    <app-user-files-component [UserId]="staff!.id"></app-user-files-component>
  </div>

  <div class="section" *ngIf="activeSection === 'details'">
    <h3>Audit Details</h3>
    <p><strong>Created By:</strong> {{ staff.createdBy || 'N/A' }}</p>
    <p><strong>Created At:</strong> {{ staff.createdAt ? (staff.createdAt | date:'medium') : 'N/A' }}</p>
    <p><strong>Updated By:</strong> {{ staff.updatedBy || 'N/A' }}</p>
    <p><strong>Updated At:</strong> {{ staff.updatedAt ? (staff.updatedAt | date:'medium') : 'N/A' }}</p>
  </div>
</div>
